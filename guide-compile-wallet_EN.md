# Compile Streamies Wallet
Roadmap to compile the Streamies Cryptonics Wallet (STRMS).
Some users encounter trojans when using the precompiled version of the wallet on Github. The compiled version itself does not seem to be infected, that's the reason for this guide.
I couldn't find complete instructions on how to compile the wallet, so I created my own. These instructions are taken from what I could find in the sources (Streamies-x-x-x/depends/README.md), in the PIVX documentation, and from the research I did on the internet to correct some errors that were displayed.
For the moment I have only tested for the linux x86_64 platform. Compiled on Ubuntu 20.04 by the WSL2 platform.

## Prerequisites
You need disk space, at least 2.5Gb of free space (the compilation leaves me a ~2.1G folder)
You also need a good amount of ram, at least 2-3GB, if you are doing this on a computer with little memory, make sure you have an active swap file with it:
```
swapon --show
```
If there is no output it means that there is no swap file, in this case we will create one, my VPS has 2Gb of ram, the good practice is that the swap is double the ram, but it seems exaggerated so I made one of 3Gb:
```
sudo fallocate -l 3G /swapfile && sudo chmod 600 /swapfile && sudo mkswap /swapfile && sudo swapon /swapfile
```
You can check that everything went well by retyping the swapon --show command, you should see your "swap file" there.
If you have enough memory (3G or +), and/or your swap file is ready, then you can proceed to the next step.

## Dependencies
You have to download all the tools needed to compile the wallet.
```
sudo apt-get update
sudo apt-get install make automake cmake curl g++-multilib libtool binutils-gold bsdmainutils pkg-config python3 patch libssl-dev libgmp-dev
```
There are other dependencies, but we'll compile them later.

## Compilation
### Step 1: Retrieving the sources:
Go to a folder of your choice, get the sources of the last wallet streamies (Example version: 2.4.3) and decompress it:
```
wget https://github.com/Streamies/Streamies/archive/v2.4.3.tar.gz
tar -xzvf v2.4.3.tar.gz
```

Once the files have been decompressed, go to the root of the new directory created by decompressing the tar.gz file, and we will make various scripts contained in this folder executable, so the compilations operations can be carried out without errors:

```
# We're going in folder
cd Streamies-2.4.3/
# We apply execution rights to several scripts
chmod +x autogen.sh contrib/install_db4.sh share/genbuild.sh
```

### Step 2: Generating dependencies, configure files and makefile
We will first generate the dependencies in order to include them in the final binary.
To do this we must go to the "depends" folder and launch make, the script will download and compile the necessary dependencies.
```
cd depends/
make
# This process is long enough! You can speed it up by adding -jX to make, where X is the number of your real cores, e.g. "make -j4" for a 4-core processor.
```
***Windows WSL2 Note:*** If you get an error like "/bin/bash: 1 Syntax error:"(" unexpected", it's probably because you're using WSL, the problem is that windows adds "windows" paths in your $PATH, these contain spaces and seem to be the cause of this bug. I could solve my problem by typing "echo $PATH", I modified the output to remove the path with spaces (example: C:/Program Files/...) then I exported my corrected paths with "export $PATH="<MyCorrectedPaths>"". This modification is not persistent, if you make an error that causes bugs, close your WSL terminals, reopen them and remodify the paths paying attention to the syntax.

We will now use the scripts included in the source to prepare the installation, to do this we go back to the root folder and run autogen:
```
cd ..
./autogen.sh
# Generate the configure file we'll need below.
```
The wallet uses an old version of the BerkeleyDB database (v4.8), it is no longer available in official repo's, so it must be generated. Luckily a script is provided with the sources, we will execute it:
```
# Make sure before you run that you're still in the Streamies-x-x-x/ folder.
./contrib/install_db4.sh `pwd`
```
After a few minutes/seconds depending on the power of your system, the script should end with something like :
```
  export BDB_PREFIX='/<PWD>/Streamies-2.4.3/db4'
# <PWD> will represent your personalized path.
  ./configure BDB_LIBS="-L${BDB_PREFIX}/lib -ldb_cxx-4.8" BDB_CFLAGS="-I${BDB_PREFIX}/include"
# This is the custom command for you to force compilation with the database we just generated.
```

We generate the Makefile, with configure, the line generated by the script for the bdd and we will add the link to the dependencies we generated, as well as a flag reducing the debug output to reduce the size of the binaries:
```
# Make sure before you run that you're still in the Streamies-x-x-x/ folder.
# First we export the variable BDB_PREFIX, to do this we simply copy and paste the previously generated "export ..." line and validate it by enter.
export BDB_PREFIX=$PWD/db4
# We add our directory of dependencies and validate it by enter.
export CONFIG_SITE=$PWD/depends/x86_64-linux-gnu/share/config.site
# Then we run configure with these arguments to generate the makefile, I added CXXFLAGS="-O2" to avoid writing the debug in the binaries and so save (a lot of) space.
./configure --prefix=/ BDB_LIBS="-L${BDB_PREFIX}/lib -ldb_cxx-4.8" BDB_CFLAGS="-I${BDB_PREFIX}/include" CXXFLAGS="-O2" 

# According to the PIVX documentation, if you lack ram to create and/or compile you can try to add the following arguments after ./configure CXXFLAGS="--param ggc-min-expand1 --param gcc-min-heapsize=32768"
# I've never tried it!  
```

### Step 3: Compilation!
We're almost there! Only the wallet is left to compile!
To launch the compilation you just have to run the make command in the root folder:
```
make
# This process is long enough! You can speed it up by adding -jX to make, where X is the number of your real cores, e.g. "make -j4" for a 4-core processor.
```
Depending on the power of your computer, this can take from a few minutes to a few hours. In the end if everything went well, you should find in the src/ folder many files including those we are interested to know about:
- streamiesd
- strealies-cli
- streamies-tx

You will also find streamies-qt in the subfolder "src/qt/"

You will probably notice that the files are quite heavy, especially if you didn't set the CXXFLAGS="-O2" flag to configure, I thought I made a mistake at first, but in reality the files are compiled with a lot of debug info, which are not useful in general use. We can clean these files and reduce them in size, for this we will use the strip tool:
```
# Still in the Streamies-x-x-x/ folder
strip -v src/streamies-cli src/streamies-tx src/streamiesd
```
You are now with your wallet compiled especially for you and in an acceptable size.
If you plan to use it on this machine, then you can run the command:
```
sudo make install
```
This will copy the binary files to the right places (/usr/local/bin/) so you can use it easily from any folder and install the "man" files to get the documentation.

If you are going to use it somewhere else you can compress the files and move them around where you want:
```
tar -czvf streamies-2.4.3.tar.gz src/streamies-cli src/streamies-tx src/streamiesd src/qt/streamies-qt
```
